# cookcode
- ì„œë¹„ìŠ¤ ì†Œê°œ : ëƒ‰ì¥ê³  ì¬ë£Œ ê´€ë¦¬ & ë ˆì‹œí”¼ ê³µìœ  ì»¤ë®¤ë‹ˆí‹°

í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ Needsë¥¼ ì¶©ì¡±ì‹œí‚¤ê¸° ìœ„í•˜ì—¬ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
* ë‚´ê°€ ê°€ì§„ ì‹ì¬ë£Œë¥¼ ì´ìš©í•´ì„œ ì–´ë–¤ ê²ƒì„ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ? 
* ë‚´ê°€ ìš”ë¦¬í•œ ê³¼ì •ì„ ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê³µìœ í•˜ê³  ì‹¶ë‹¤. 

ë ˆì‹œí”¼ë¥¼ ì‰½ê²Œ ë§Œë“¤ê¸°ìœ„í•´ì„œ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ë¯¸ë¦¬ë³´ê¸° ì¤‘ ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. 

ìœ íŠœë¸Œ ì‡¼ì¸ ì²˜ëŸ¼ ì§§ì€ ì˜ìƒì„ ë§Œë“¤ì–´ ì œê³µí•˜ëŠ” `ì¿ í‚¤` ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. 

[ì´ê³³](https://www.youtube.com/playlist?list=PLow6eB4W8f0fgjKj2_k8eavCbxeajqtBL)ì—ì„œ ëª¨ë“  í”„ë¡œì íŠ¸ ì˜ìƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì—ëŠ” ì¼ë¶€ ì˜ìƒì„ ê²Œì‹œí–ˆìŠµë‹ˆë‹¤. 
   
## 2023-1í•™ê¸° SW ìº¡ìŠ¤í†¤ë””ìì¸

### Member ğŸ‘¨ğŸ¼â€ğŸ¤â€ğŸ‘¨ğŸ¼

|                          ì‹ ê¸°ì²                            |                          ê¹€ìŠ¹ì€                           |                          ë°•í•´ì¸                          |                          ë…¸ìš°ì˜                          |
| :-------------------------------------------------------: | :-------------------------------------------------------: | :-------------------------------------------------------: | :-------------------------------------------------------: |
|                      ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼                       |                      ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼                       |                      ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼                       |                      ì†Œí”„íŠ¸ì›¨ì–´í•™ê³¼                       |
|                    íŒ€ì¥, ë°±ì—”ë“œ ê°œë°œì                    |                          ë°±ì—”ë“œ ê°œë°œì                           |                        ì•ˆë“œë¡œì´ë“œ ê°œë°œì                          |                            IOS ê°œë°œì                             |                        ë°±ì—”ë“œ                           |
|    [@ì‹ ê¸°ì² ](https://github.com/skck0226)     |        [@ê¹€ìŠ¹ì€](https://github.com/julie0005)         |           [@ë°•í•´ì¸](https://github.com/haeiny-cloud)            |         [@ë…¸ìš°ì˜](https://github.com/99Page)          |


* * *

í•´ë‹¹ í˜ì´ì§€ëŠ” Android ëª¨ë°”ì¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œì íŠ¸ ê´€ë¦¬ repositoryì…ë‹ˆë‹¤.   

* * *

## Android ê¸°ìˆ  ìŠ¤íƒ

- ì–¸ì–´: `Kotlin`
- IDE : `Android Studio`
- ê°œë°œ ë²„ì „ : `Android 11`
- ê°œë°œ í™˜ê²½ : `Pixel 3a(AVD), Galaxy S10e(SM-G970N)`
- ì£¼ìš” í”„ë ˆì„ì›Œí¬ : `Kotlin, Android, Retrofit2, OkHttp, ffmpeg`

## ì£¼ìš” í´ë” ë°”ë¡œê°€ê¸°

- Source Codes : [Link](https://github.com/ajou-swef/cookcode-android/tree/main/cookcode/app/src/main/java/com/swef/cookcode)
- XML Layout Files : [Link](https://github.com/ajou-swef/cookcode-android/tree/main/cookcode/app/src/main/res/layout)
- Drawable Components : [Link](https://github.com/ajou-swef/cookcode-android/tree/main/cookcode/app/src/main/res/drawable)
- Total Resource Folder : [Link](https://github.com/ajou-swef/cookcode-android/tree/main/cookcode/app/src/main/res)

* * *

## ì£¼ìš” ê°œë°œ ë‚´ìš©
1. Retrofit2ë¥¼ ì‚¬ìš©í•œ REST API êµ¬í˜„
  - Retrofitì€ OkHttpë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤. ì„œë²„ í†µì‹ ì„ ìœ„í•œ HTTP APIë¥¼ Kotlinì˜ Interfaceë¡œ ê°„ë‹¨í•˜ê²Œ ë³€í™˜í•˜ì—¬ API í˜¸ì¶œì„ ì‰½ê²Œ ë„ì™€ì¤ë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” ê° ê¸°ëŠ¥ ë³„(ì¿ í‚¤, ë ˆì‹œí”¼, ì‚¬ìš©ì ë“±)ë¡œ API Interfaceë¥¼ ë‚˜ëˆ„ì–´ ì‘ì„±í•˜ì˜€ê³ , ì‚¬ìš©í•˜ë ¤ëŠ” REST APIë¥¼ ê° ê¸°ëŠ¥ ë³„ API ê°ì²´ë³€ìˆ˜ë¥¼ ë§Œë“¤ì–´ ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©í•˜ê³ ì í–ˆìŠµë‹ˆë‹¤.    
  - ì½”ë“œ ì˜ˆì‹œ :   
  
[CookieAPI.kt](https://github.com/ajou-swef/cookcode-android/blob/main/cookcode/app/src/main/java/com/swef/cookcode/api/CookieAPI.kt)
<pre>
<code>
@DELETE("cookie/comments/{commentId}")
    fun deleteCookieComment(
        @Header("accessToken") accessToken: String,
        @Path("commentId") commentId: Int,
    ): Call<StatusResponse>
</code>
</pre>
[CommentRecyclerviewAdapter.kt](https://github.com/ajou-swef/cookcode-android/blob/main/cookcode/app/src/main/java/com/swef/cookcode/adapter/CommentRecyclerviewAdapter.kt)
<pre>
<code>
private fun deleteCookieComment(commentId: Int){
            cookieAPI.deleteCookieComment(accessToken, commentId).enqueue(object :
                Callback<StatusResponse> {
                override fun onResponse(
                    call: Call<StatusResponse>,
                    response: Response<StatusResponse>
                ) {
                    if (response.isSuccessful){
                        putToastMessage("ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.")
                        listener.itemOnClick(cookieId)
                    }
                    else {
                        putToastMessage("ì—ëŸ¬ ë°œìƒ!")
                    }
                }

                override fun onFailure(call: Call<StatusResponse>, t: Throwable) {
                    putToastMessage("ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")
                }
            })
        }
</code>
</pre>
2. Coroutineì„ í™œìš©í•˜ì—¬ suspend functionì„ êµ¬í˜„í•˜ê³ , ë„¤íŠ¸ì›Œí¬ í†µì‹  ë¹„ë™ê¸° ì²˜ë¦¬
  - Coroutineì€ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•¨ìœ¼ë¡œì¨ Main Thread(UI Thread)ì—ì„œ í™”ë©´ì„ ë¡œë”©í•˜ê¸° ìœ„í•´ ë§ì€ ì‘ì—…ì„ í•˜ëŠ” ê²ƒì„ í”¼í•˜ê³ , ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‘ì—…í•¨ìœ¼ë¡œì¨ ì„±ëŠ¥ ë¶€í•˜ë¥¼ ì¤„ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. Coroutineì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” suspend functionì´ë¼ëŠ” ë¹„ë™ê¸° ì‘ì—… í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤. í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œëŠ” ëŒ€ìš©ëŸ‰ íŒŒì¼ì¸ ë¹„ë””ì˜¤ë¥¼ ë‹¤ìš´ë¡œë“œ ë°›ëŠ” ì¿ í‚¤ ì¡°íšŒ ì‘ì—…ì—ì„œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ Coroutineê³¼ suspend functionì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.
  - ì½”ë“œ ì˜ˆì‹œ : 

[CookieViewpagerAdapter.kt](https://github.com/ajou-swef/cookcode-android/blob/main/cookcode/app/src/main/java/com/swef/cookcode/adapter/CookieViewpagerAdapter.kt)
<pre>
<code>
fun bind(item: CookieData) {
         binding.cookie.setBackgroundResource(R.drawable.loading_video_page)
         binding.progressBar.visibility = View.VISIBLE

         initModifyDeleteButton(item.cookieId)

         CoroutineScope(Dispatchers.Main).launch {
             val videoUri = withContext(Dispatchers.IO) {
                 prepareVideo(item.videoUrl)
             }

             if (videoUri != null) {
                 binding.cookie.setBackgroundResource(0)
                 binding.cookie.setVideoURI(videoUri)
                 binding.progressBar.visibility = View.GONE
                 ...
</code>
</pre>
<pre>
<code>
private suspend fun prepareVideo(videoUrl: String): Uri? = withContext(Dispatchers.IO) {
      return@withContext downloadVideo(videoUrl)
}
        
private suspend fun downloadVideo(videoUrl: String): Uri? = withContext(Dispatchers.IO) {
      val client = OkHttpClient.Builder().build()
      val request = Request.Builder()
          .url(videoUrl)
          .build()

      val response = client.newCall(request).execute()
      val responseBody: ResponseBody? = response.body

      if (response.isSuccessful && responseBody != null) {
          val timeStamp = SimpleDateFormat("yyyyMMdd_HHmmss", Locale.getDefault()).format(Date())
          val cacheDir = context.getExternalFilesDir(Environment.DIRECTORY_MOVIES)
          val tempFile = File.createTempFile("VIDEO_$timeStamp", ".mp4", cacheDir)

          val inputStream = responseBody.byteStream()
          val outputStream = FileOutputStream(tempFile)

          inputStream.use { input ->
              outputStream.use { output ->
                  input.copyTo(output)
              }
          }

          return@withContext Uri.parse(tempFile.absolutePath)
      }

      return@withContext null
}
</code>
</pre>
3. ffmpegë¥¼ ì‚¬ìš©í•˜ì—¬ ì˜ìƒ ë³‘í•© ë° ì¸ì½”ë”© ì²˜ë¦¬
  - ì¿ í‚¤ë¥¼ ì œì‘í•  ë•Œ ì§§ì€ ì˜ìƒë“¤ì„ ì—…ë¡œë“œí•˜ê³  í•˜ë‚˜ì˜ ì˜ìƒìœ¼ë¡œ ë³‘í•©ì²˜ë¦¬í•˜ì—¬ ì„œë²„ì— ì—…ë¡œë“œ í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ffmpegë¼ëŠ” ì˜ìƒ ì¸ì½”ë”© ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ffmpegì˜ ì‚¬ìš© ë°©ë²•ì€ ëª…ë ¹ í”„ë¡¬í”„íŠ¸ ì°½ì—ì„œ ì‚¬ìš©í•˜ë“¯ì´ ëª…ë ¹ì–´ë¥¼ ë§Œë“¤ì–´ execute í•´ì•¼í•©ë‹ˆë‹¤. ì¿ í‚¤ëŠ” ëª¨ë°”ì¼ í™”ë©´ì— ìµœì í™” ë˜ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì„¸ë¡œë¡œ ê¸´ 720x1080 í¬ê¸°ë¡œ ì¸ì½”ë”©í•˜ì—¬ ë³‘í•©í•´ì£¼ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ, ë³‘í•©ëœ ì˜ìƒì˜ ìš©ëŸ‰ì´ ë„ˆë¬´ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë‚®ì€ ë¹„íŠ¸ë ˆì´íŠ¸ë¡œ ì¸ì½”ë”© í•˜ë˜ ì˜ìƒì˜ í’ˆì§ˆì€ ìµœëŒ€í•œ ì‚´ë¦´ ìˆ˜ ìˆë„ë¡ ì˜µì…˜ì„ ì¡°ì ˆí–ˆìŠµë‹ˆë‹¤.
  - ì½”ë“œ ì˜ˆì‹œ : 
  
[CookieFormActivity.kt](https://github.com/ajou-swef/cookcode-android/blob/main/cookcode/app/src/main/java/com/swef/cookcode/CookieFormActivity.kt)
<pre>
<code>
fun mergeVideos(videoPaths: List<String>): Int {
        mergedVideoFile = this.filesDir.absolutePath + "/merged_video.mp4"

        val command = StringBuilder()

        command.append("-y")
        for (videoPath in videoPaths) {
            command.append(" -i ").append(videoPath)
        }
        command.append(" -filter_complex ").append("\"")
        for (i in videoPaths.indices) {
            command.append("[$i:v]setpts=PTS-STARTPTS,scale=720x1080,fps=24,format=yuv420p[v$i];")
            command.append("[$i:a]aformat=sample_fmts=fltp:sample_rates=48000:channel_layouts=stereo[a$i];")
        }
        for (i in videoPaths.indices) {
            command.append("[v$i][a$i]")
        }
        command.append("concat=n=").append(videoPaths.size).append(":v=1:a=1[v][a]").append("\"")
        command.append(" -map \"[v]\" -map \"[a]\" ").append("-vsync 0 ").append(mergedVideoFile)

        return FFmpeg.execute(command.toString())
    }
</code>
</pre>
### ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì—° ì˜ìƒ
